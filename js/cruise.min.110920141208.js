function init_cruise_search(b,a){if(typeof a!=="undefined"&&a){a=true}else{a=false}if(b==undefined){b=false}if(b){get_current_search(3)}init_cruise_date("#startdate","#duration","#enddate","#show_search_end_date","",a);if($(".search-choice-close").length==0&&$("#destination").val()!=""&&!a){add_clear_search()}$("#destination").blur(function(){if($.trim($("#destination").val())!=""&&!a){add_clear_search()}});$("#destination").on("input",function(){if($.trim($("#destination").val())!=$("#destination").data("selected_value")){$("#cruise_destination_input").val("");$("#oid").val("");$(".search-choice-close").remove();$("#destination").popover("hide")}});$("#destination").popover({html:true,trigger:"click",template:'<div class="popover suggestion-des"><div class="arrow"></div><div class="popover-inner"><div class="popover-content"><p></p></div></div></div>',content:$("#suggestion-des").html(),placement:"right"}).on("shown.bs.popover",function(c){$(".suggestion-des a").click(function(){$("#destination").val($(this).attr("data-name"));$(".typeahead").typeahead("val",$(this).attr("data-name"));$("#cruise_destination_input").val($(this).attr("data-url-title"));$("#oid").val($(this).attr("data-type")+"-"+$(this).attr("data-id"));$("#destination").data("selected_value",$("#destination").val());add_clear_search();$("#destination").popover("hide");$(".typeahead").typeahead("close")})})}function init_cruise_date(f,h,g,b,a,d){var c=new Date();if(a!=""){$(f).val(a)}get_end_date(f,h,g,b,d);$(f).change(function(){get_end_date(f,h,g,b,d)});$(h).change(function(){get_end_date(f,h,g,b,d)});var e="#btn_"+f.replace("#","");$(e).click(function(){$(f).focus()})}function set_up_cruise_calendar(b){if(typeof b!=="undefined"&&b){b=true}else{b=false}var a=new Date();a=dateFormat(a);if($("#startdate").length>0){set_up_calendar("#startdate",null,b)}if($("#checkin_date").length>0){set_up_calendar("#checkin_date",null,b)}}function set_up_cruise_autocomplete(b){if(typeof b!=="undefined"&&b){b=true}else{b=false}var a=new Bloodhound({datumTokenizer:function(e){return Bloodhound.tokenizers.whitespace(e.name)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:"/suggest_cruise_destinations/?query=%QUERY"}});var c=new Bloodhound({datumTokenizer:function(e){return Bloodhound.tokenizers.whitespace(e.name)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:"/suggest_cruises/?query=%QUERY"}});a.initialize();c.initialize();$("#destination").typeahead({minLength:2,highlight:true,hint:false},{displayKey:"name",source:a.ttAdapter(),templates:{header:'<span class="lb-header">Tỉnh/Thành Phố/Địa danh</span>'}},{displayKey:"name",source:c.ttAdapter(),templates:{header:'<span class="lb-header">Du thuyền</span>'}}).on("typeahead:selected",function(e,d){$("#cruise_destination_input").val(d.url_title);$("#oid").val(d.type+"-"+d.id);$("#destination").data("selected_value",$("#destination").val());if(!b){add_clear_search()}$("#destination").popover("hide")})}function get_end_date(e,h,f,b,c){var d=$(e).val();if(check_date(d)){var a=get_JS_Date(d);var g=$(h).val();if(g!=""&&g>0){a.setDate(a.getDate()+parseInt(g,10));if(check_date(dateFormat(a))){$(b).html(dateFormat(a));$(f).val(dateFormat(a))}}else{$(b).html("");$(f).val("")}if(c){if($(f).val()!=""){$("#block_end_date").show()}else{$("#block_end_date").hide()}}}}function validate_cruise_search(){if($.trim($("#destination").val())==""){alert("Xin vui lòng nhập Tỉnh/Thành Phố/Điểm Du Lịch/Tên Du Thuyền ");$("#destination").focus();$("#destination").addClass("bpv-input-warning");return false}var a=$("#startdate").val();if($.trim(a)==""){$("#startdate").focus();$("#startdate").addClass("bpv-input-warning");alert('Xin vui lòng nhập thông tin "Ngày khởi hành"');return false}if(!check_date(a)){$("#startdate").focus();$("#startdate").addClass("bpv-input-warning");alert('"Ngày nhận phòng" phải theo định dạng '+FORMAT_DATE);return false}return true}function search_cruises_in_waiting_page(a){var b=window.location.hash;if(b!=""&&b!=undefined){b=b.substring(1)}$.ajax({url:a+"?isAjax=1&"+b,type:"GET",cache:true,data:{},success:function(c){if(c.indexOf("[cruise-detail-page]")!=-1){c=c.replace("[cruise-detail-page]","");window.location=c}else{if(c.indexOf("[search-suggestion]")!=-1){c=c.replace("[search-suggestion]","");window.location=c}else{$(".bpv-content").html(c)}}},error:function(e,d,c){}})}function init_cruise_paging(a){$(".pagination a").click(function(){var b=$(this).attr("href");page=get_url_var("page",b);if(page==""||page==undefined){page=0}page=parseInt(page);search_sort_cruises(a,page);return false})}function search_sort_cruises(c,d){var b=validate_cruise_search();if(b){var a=get_search_sort_params(d);window.location=c+"#"+a;go_position(0);$(".bpv-update-wrapper").show();$.ajax({url:c+"?isAjax=1&"+a,type:"GET",cache:true,data:{},success:function(e){if(e.indexOf("[hotel-detail-page]")!=-1){e=e.replace("[hotel-detail-page]","");window.location=e}else{if(e.indexOf("[search-suggestion]")!=-1){e=e.replace("[search-suggestion]","");window.location=e}else{$(".bpv-content").html(e)}}},error:function(g,f,e){}})}return false}function get_search_sort_params(j){var k=$("#destination").val();k=encodeURIComponent(k);var l=$("#startdate").val();var b=$("#enddate").val();var e=$("#duration").val();var c=$("#oid").val();var h=$("input[name='filter_price\\[\\]']:checked").map(function(){return $(this).val()}).get();var g=$("input[name='filter_star\\[\\]']:checked").map(function(){return $(this).val()}).get();var a=$("input[name='filter_area']:checked").map(function(){return $(this).val()}).get();var i=$("input[name='filter_facility\\[\\]']:checked").map(function(){return $(this).val()}).get();var f=$("#sort_by_value").val();var d="destination="+k;d=d+"&startdate="+l;d=d+"&duration="+e;d=d+"&enddate="+b;if(c!=""){d=d+"&oid="+c}if(h!=""){d=d+"&price="+h}if(g!=""){d=d+"&star="+g}if(a!=""){d=d+"&area="+a}if(i!=""){d=d+"&facility="+i}if(f!=""){d=d+"&sort="+f}if(j!=undefined){d=d+"&page="+j}return d}function sort_by(b,a){$("#sort_by_value").val(b);search_sort_cruises(a)}function remove_filter(c,b,a){b=b.replace(".","_");$("#"+c+"_"+b).prop("checked",false);search_sort_cruises(a)}function validate_tour_check_rate_form(){var a=$("#checkin_date").val();if($.trim(a)==""){$("#checkin_date").focus();$("#checkin_date").addClass("bpv-input-warning");alert('Xin vui lòng nhập thông tin "Ngày đi"');return false}if(!check_date(a)){$("#checkin_date").focus();$("#checkin_date").addClass("bpv-input-warning");alert('"Ngày đi" phải theo định dạng '+FORMAT_DATE);return false}return true}function update_cruise_total_payment(c){var a=0;$(".room-rate-payment").each(function(){a=a+parseInt($(this).attr("rate"))});$(".surcharge-payment").each(function(){a=a+parseInt($(this).attr("rate"))});var d=$("#total_discount").attr("rate");if(d==undefined||d==""){d=0}else{d=parseInt(d)}var b=$("#applied_code_discount").attr("rate");if(b==undefined||b==""){b=0}else{b=parseInt(b)}var e=a-d-b;$("#total_payment").html(bpv_format_currency(e,c));return e};