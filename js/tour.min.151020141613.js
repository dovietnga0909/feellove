function search_tours_in_waiting_page(a){var b=window.location.hash;if(b!=""&&b!=undefined){b=b.substring(1)}$.ajax({url:a+"?isAjax=1&"+b,type:"GET",cache:true,data:{},success:function(c){if(c.indexOf("[tour-detail-page]")!=-1){c=c.replace("[tour-detail-page]","");window.location=c}else{if(c.indexOf("[search-suggestion]")!=-1){c=c.replace("[search-suggestion]","");window.location=c}else{$(".bpv-content").html(c)}}},error:function(e,d,c){}})}function sort_by(b,a){$("#sort_by_value").val(b);search_sort_tours(a)}function search_sort_tours(c,d){var b=true;var e=$("#is_outbound").val();if(e==undefined||e==""){b=validate_tour_search()}if(b){var a=get_search_sort_params(d);window.location=c+"#"+a;go_position(0);$(".bpv-update-wrapper").show();$.ajax({url:c+"?isAjax=1&"+a,type:"GET",cache:true,data:{},success:function(f){if(f.indexOf("[tour-detail-page]")!=-1){f=f.replace("[tour-detail-page]","");window.location=f}else{if(f.indexOf("[search-suggestion]")!=-1){f=f.replace("[search-suggestion]","");window.location=f}else{$(".bpv-content").html(f)}}},error:function(h,g,f){}})}return false}function get_search_sort_params(i){var k=$("#tour_destination").val();k=encodeURIComponent(k);var m=$("#departure").val();m=encodeURIComponent(m);var l=$("#tour_departure_date").val();var g=$("#dep_id").val();var j=$("#des_id").val();var e=$("#duration").val();var h=$("input[name='filter_price\\[\\]']:checked").map(function(){return $(this).val()}).get();var n=$("input[name='filter_departing']:checked").map(function(){return $(this).val()}).get();var a=$("input[name='filter_categories\\[\\]']:checked").map(function(){return $(this).val()}).get();var b=$("input[name='filter_duration\\[\\]']:checked").map(function(){return $(this).val()}).get();var f=$("#sort_by_value").val();var c=$("#is_outbound").val();var d="departure="+m;d=d+"&destination="+k;d=d+"&startdate="+l;d=d+"&duration="+e;if(g!=""){d=d+"&dep_id="+g}if(j!=""){d=d+"&des_id="+j}if(h!=""){d=d+"&price="+h}if(e!=""){d=d+"&duration="+e}if(n!=""){d=d+"&f_departing="+n}if(b!=""){d=d+"&f_duration="+b}if(a!=""){d=d+"&category="+a}if(f!=""){d=d+"&sort="+f}if(i!=undefined){d=d+"&page="+i}if(c!=undefined){d=d+"&is_outbound="+c}return d}function remove_filter(c,b,a){b=b.replace(".","_");$("#"+c+"_"+b).prop("checked",false);search_sort_tours(a)}function init_tour_paging(a){$(".pagination a").click(function(){var b=$(this).attr("href");page=get_url_var("page",b);is_outbound=get_url_var("is_outbound",b);if(page==""||page==undefined){page=0}page=parseInt(page);search_sort_tours(a,page,is_outbound);return false})}function validate_tour_check_rate_form(){var c="#checkin_date";if($("#departure_id").length>0){var b=$("#departure_id").val();c="#checkin_date_"+b}var a=$(c).val();if($.trim(a)==""){$(c).focus();$(c).addClass("bpv-input-warning");alert('Xin vui lòng nhập thông tin "Ngày đi"');return false}if(!check_date(a)){$(c).focus();$(c).addClass("bpv-input-warning");alert('"Ngày đi" phải theo định dạng '+FORMAT_DATE);return false}return true}function check_accommodation_rates(){$(".bpv-rate-loading").show();$("#rate_content").hide();$.ajax({url:"/tour_details/check_rates/?"+$("#check_rate_form").serialize(),type:"GET",cache:true,data:{},success:function(a){$(".bpv-rate-loading").hide();$("#rate_content").html(a);$("#rate_content").show()},error:function(c,b,a){}})}function init_tour_details(){init_review_tab("#tour_tabs");$('a[data-toggle="tab"]').on("shown.bs.tab",function(g){$("#book-bottom-box").removeClass("hide");if($(this).attr("href")=="#tab_price_table"){$("#book-bottom-box").addClass("book-bottom-box")}else{if($(this).attr("href")=="#tab_booking"){$("#book-bottom-box").addClass("hide")}else{$("#book-bottom-box").removeClass("book-bottom-box")}}});$(".btn-book-tour").click(function(){open_book_tab()});$(".btn_book_t").click(function(){open_book_tab()});$(".btn-tour-support").click(function(){$("#btn-tour-support").hide();$("#tour_contact").show()});var f=$(".bpv-tab-tours");var b=$(".itinerary-summary");var a=f.width();var d=b.width();var e=900;var c=Math.round(b.offset().top);$(window).scroll(function(){var g=$(".itinerary-summary").height();var h=$("#btn-tour-support").offset().top-g;if($(this).scrollTop()>e&&$(this).scrollTop()<h){f.addClass("f-nav");f.css("width",a)}else{f.removeClass("f-nav");f.css("width","100%")}if($(".bpv-call-us").is(":visible")){c=$(".bpv-call-us").offset().top+$(".bpv-call-us").height()}else{if($(".bpv-search-left").is(":visible")){c=$(".bpv-search-left").offset().top+$(".bpv-search-left").height()}}if($(this).scrollTop()>c&&$(this).scrollTop()<h){b.addClass("f-nav-side");b.css("width",d)}else{b.removeClass("f-nav-side");b.css("width","auto")}});$("#tour_tabs a").click(function(g){if($(window).scrollTop()>e){$("html, body").animate({scrollTop:e},"fast")}})}function open_book_tab(){$('#tour_tabs a[href="#tab_booking"]').tab("show");$("html, body").animate({scrollTop:808},"fast")}function update_tour_total_payment(c){var a=0;$(".room-rate-payment").each(function(){a=a+parseInt($(this).attr("rate"))});$(".surcharge-payment").each(function(){a=a+parseInt($(this).attr("rate"))});var d=$("#total_discount").attr("rate");if(d==undefined||d==""){d=0}else{d=parseInt(d)}var b=$("#applied_code_discount").attr("rate");if(b==undefined||b==""){b=0}else{b=parseInt(b)}var e=a-d-b;$("#total_payment").html(bpv_format_currency(e,c));return e};